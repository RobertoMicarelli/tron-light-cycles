<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON Light Cycles - Educational Training Arena</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <!-- SCHERMATA LOGIN -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <h1 class="neon-text">TRON</h1>
            <h2 class="subtitle">LIGHT CYCLES TRAINING ARENA</h2>
            
            <div class="login-box">
                <h3>üë§ ACCEDI AL SISTEMA</h3>
                <input type="text" id="playerName" placeholder="Inserisci il tuo nome" maxlength="15">
                <button onclick="login()" class="btn-primary">ENTRA NELLA GRIGLIA</button>
            </div>

            <div class="info-box">
                <p>üß† <strong>Obiettivo Formativo:</strong></p>
                <p>Sviluppa decision-making rapido, pensiero strategico e gestione dello stress sotto pressione</p>
            </div>
        </div>
    </div>

    <!-- SCHERMATA SELEZIONE MODALIT√Ä -->
    <div id="modeScreen" class="screen">
        <div class="container">
            <h1 class="neon-text">SCEGLI MODALIT√Ä</h1>
            <p class="player-welcome">Benvenuto, <span id="welcomeName"></span></p>

            <div class="mode-selection">
                <div class="mode-card" onclick="showMultiplayerOptions()">
                    <h2>üåê MULTIPLAYER ONLINE</h2>
                    <p>Sfida 2-4 giocatori in tempo reale</p>
                    <p class="mode-detail">‚Ä¢ 2p: Migliore di 3 su 5 round</p>
                    <p class="mode-detail">‚Ä¢ 3p: Migliore di 3 su 7 round</p>
                    <p class="mode-detail">‚Ä¢ 4p: Migliore di 3 su 10 round</p>
                    <p class="mode-detail">‚Ä¢ CPU aggiuntive ogni 3 round</p>
                    <button class="btn-primary">SELECCIONA GIOCATORI</button>
                </div>

                <div class="mode-card" onclick="selectMode('campaign')">
                    <h2>üéØ CAMPAGNA PROGRESSIVA</h2>
                    <p>Affronta nemici sempre pi√π numerosi</p>
                    <p class="mode-detail">‚Ä¢ Livello 1-3: +1 nemico per livello</p>
                    <p class="mode-detail">‚Ä¢ Livello 4+: +1 nemico ogni 2 livelli</p>
                    <p class="mode-detail">‚Ä¢ AI adattiva e strategica</p>
                    <button class="btn-primary">INIZIA CAMPAGNA</button>
                </div>
            </div>

            <button onclick="logout()" class="btn-secondary">ESCI</button>
        </div>
    </div>

    <!-- SCHERMATA SELEZIONE GIOCATORI MULTIPLAYER -->
    <div id="multiplayerOptionsScreen" class="screen">
        <div class="container">
            <h1 class="neon-text">MULTIPLAYER</h1>
            <p class="player-welcome">Scegli il numero di giocatori</p>

            <div class="player-selection">
                <div class="player-option" onclick="selectPlayerCount(2)">
                    <h2>üë• DUELO (2 GIOCATORI)</h2>
                    <p>Migliore di 3 su 5 round</p>
                    <p class="mode-detail">‚Ä¢ Partita veloce e intensa</p>
                    <p class="mode-detail">‚Ä¢ Perfetto per sfide 1v1</p>
                    <button class="btn-primary">2 GIOCATORI</button>
                </div>

                <div class="player-option" onclick="selectPlayerCount(3)">
                    <h2>üî∫ TRIANGOLO (3 GIOCATORI)</h2>
                    <p>Migliore di 3 su 7 round</p>
                    <p class="mode-detail">‚Ä¢ Strategia a tre vie</p>
                    <p class="mode-detail">‚Ä¢ Alleanze temporanee</p>
                    <button class="btn-primary">3 GIOCATORI</button>
                </div>

                <div class="player-option" onclick="selectPlayerCount(4)">
                    <h2>‚¨ú QUADRATO (4 GIOCATORI)</h2>
                    <p>Migliore di 3 su 10 round</p>
                    <p class="mode-detail">‚Ä¢ Caos totale garantito</p>
                    <p class="mode-detail">‚Ä¢ CPU ogni 3 round</p>
                    <button class="btn-primary">4 GIOCATORI</button>
                </div>
            </div>

            <button onclick="backToModes()" class="btn-secondary">INDIETRO</button>
        </div>
    </div>

    <!-- SCHERMATA MATCHMAKING -->
    <div id="matchmakingScreen" class="screen">
        <div class="container">
            <h1 class="neon-text">MATCHMAKING</h1>
            <div class="spinner"></div>
            <p class="waiting-text">Cercando giocatori...</p>
            <p id="waitingPlayers">Giocatori in attesa: 0</p>
            <p id="roomInfo">Stanza: -</p>
            <button onclick="cancelMatchmaking()" class="btn-secondary">ANNULLA</button>
        </div>
    </div>

    <!-- SCHERMATA GIOCO -->
    <div id="gameScreen" class="screen">
        <!-- HUD -->
        <div class="hud">
            <div class="hud-left">
                <div class="player-info player-blue">
                    <span class="player-name" id="player1Name">Player 1</span>
                    <span class="player-score" id="player1Score">0</span>
                    <div class="speed-indicator">
                        <span>VEL:</span>
                        <div class="speed-bars">
                            <div class="speed-bar active" id="p1speed1"></div>
                            <div class="speed-bar" id="p1speed2"></div>
                            <div class="speed-bar" id="p1speed3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hud-center">
                <div class="level-info">
                    <span id="levelText">LIVELLO 1</span>
                    <span id="roundText">ROUND 1/3</span>
                </div>
                <div class="countdown" id="countdown"></div>
            </div>

            <div class="hud-right">
                <div class="player-info player-yellow" id="opponentsContainer">
                    <!-- Verranno aggiunti dinamicamente gli avversari -->
                </div>
            </div>
        </div>

        <!-- Canvas del Gioco -->
        <canvas id="gameCanvas"></canvas>

        <!-- Controlli Touch per Mobile -->
        <div class="touch-controls">
            <!-- Layout: +/- a sinistra, frecce a destra -->
            <div class="touch-controls-container">
                <!-- Controlli velocit√† a sinistra -->
                <div class="touch-speed-section">
                    <div class="touch-speed-btn" data-action="speed-up">+</div>
                    <div class="touch-speed-btn" data-action="speed-down">‚àí</div>
                </div>
                
                <!-- Frecce di movimento a destra -->
                <div class="touch-arrows-section">
                    <div class="touch-arrow-grid">
                        <div class="touch-arrow" data-direction="up">‚Üë</div>
                        <div class="touch-arrow" data-direction="left">‚Üê</div>
                        <div class="touch-arrow" data-direction="down">‚Üì</div>
                        <div class="touch-arrow" data-direction="right">‚Üí</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controlli Desktop -->
        <div class="controls-info">
            <div class="control-group">
                <span class="control-label">MOVIMENTO:</span>
                <span class="control-keys">‚Üê ‚Üë ‚Üí ‚Üì</span>
            </div>
            <div class="control-group">
                <span class="control-label">VELOCIT√Ä:</span>
                <span class="control-keys">Z (‚Üë) / X (‚Üì)</span>
            </div>
            <div class="control-group">
                <button onclick="pauseGame()" class="btn-small" id="pauseBtn">PAUSA</button>
            </div>
            <div class="control-group">
                <button onclick="toggleAudio()" class="btn-small" id="audioBtn">üîä AUDIO ON</button>
            </div>
            <div class="control-group">
                <button onclick="changeMusic()" class="btn-small" id="musicBtn">üéµ CAMBIA MUSICA</button>
            </div>
        </div>
    </div>

    <!-- SCHERMATA ROUND END -->
    <div id="roundEndScreen" class="screen">
        <div class="container">
            <h1 class="neon-text" id="roundWinner"></h1>
            <div class="explosion-effect"></div>
            <div class="round-stats" id="roundStats"></div>
            <button onclick="continueToNextLevel()" class="btn-primary" id="continueBtn">‚û°Ô∏è PROSEGUI</button>
            <button onclick="backToModes()" class="btn-secondary">ESCI AL MENU</button>
        </div>
    </div>

    <!-- SCHERMATA GAME OVER -->
    <div id="gameOverScreen" class="screen">
        <div class="container">
            <h1 class="neon-text" id="finalWinner"></h1>
            <div class="final-stats" id="finalStats"></div>
            
            <!-- Sezione Debrief Formativo - VISIBILE SOLO DOPO LIVELLO 7 -->
            <div class="debrief-box" id="debriefBox" style="display: none;">
                <h3>üß† RIFLESSIONE POST-ESPERIENZA (Ciclo di Kolb)</h3>
                <div class="kolb-section">
                    <h4>üí≠ Reflective Observation:</h4>
                    <ul>
                        <li>Cosa hai sentito quando lo spazio si riduceva?</li>
                        <li>Quando hai commesso errori critici?</li>
                        <li>Come hai gestito la pressione temporale?</li>
                        <li>In quali momenti ti sei sentito pi√π sicuro/insicuro?</li>
                    </ul>
                </div>
                <div class="kolb-section">
                    <h4>üéØ Abstract Conceptualization:</h4>
                    <ul>
                        <li>Quale strategia si √® rivelata pi√π efficace?</li>
                        <li>Come hai bilanciato velocit√† e controllo?</li>
                        <li>Quali pattern hai notato nel tuo comportamento?</li>
                        <li>Come questo si applica a situazioni lavorative reali?</li>
                    </ul>
                </div>
                <div class="kolb-section">
                    <h4>üöÄ Active Experimentation:</h4>
                    <ul>
                        <li>Cosa applicherai nel tuo lavoro da domani?</li>
                        <li>In quali situazioni userai questa esperienza?</li>
                        <li>Come miglioreresti il tuo approccio decisionale?</li>
                    </ul>
                </div>
            </div>

            <!-- Messaggio per chi non ha raggiunto livello 7 -->
            <div class="info-box" id="notYetDebriefMessage" style="display: none;">
                <p>üéØ <strong>Continua a giocare!</strong></p>
                <p>Il debrief formativo completo sar√† disponibile dopo aver superato il <strong>Livello 7</strong></p>
                <p>Livello attuale: <span id="currentLevelDisplay"></span></p>
            </div>

            <button onclick="restart()" class="btn-primary">NUOVA PARTITA</button>
            <button onclick="backToModes()" class="btn-secondary">MENU PRINCIPALE</button>
        </div>
    </div>

    <!-- SCHERMATA PAUSA -->
    <div id="pauseScreen" class="screen">
        <div class="container">
            <h1 class="neon-text">PAUSA</h1>
            <button onclick="resumeGame()" class="btn-primary">RIPRENDI</button>
            <button onclick="exitToMenu()" class="btn-secondary">ESCI AL MENU</button>
        </div>
    </div>

    <!-- Script Socket.io per multiplayer -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="game.js"></script>
    
    <!-- Script per Mobile e Vercel -->
    <script>
        // Banner informativo per Mobile
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
            (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||
            window.innerWidth <= 768) {
            document.addEventListener('DOMContentLoaded', () => {
                const mobileBanner = document.createElement('div');
                mobileBanner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(90deg, #00FFFF, #FFD700);
                    color: #000;
                    text-align: center;
                    padding: 6px;
                    font-family: 'Press Start 2P', monospace;
                    font-size: 0.5rem;
                    z-index: 1000;
                    box-shadow: 0 2px 10px rgba(0,255,255,0.5);
                `;
                mobileBanner.innerHTML = 'üì± MOBILE: Usa i controlli touch in basso!';
                document.body.appendChild(mobileBanner);
                
                // Aggiusta il padding del body per mobile
                document.body.style.paddingTop = '30px';
            });
        }
        
        // Banner informativo per Vercel
        if (window.location.hostname.includes('vercel.app')) {
            document.addEventListener('DOMContentLoaded', () => {
                const banner = document.createElement('div');
                banner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(90deg, #00FFFF, #FFD700);
                    color: #000;
                    text-align: center;
                    padding: 8px;
                    font-family: 'Press Start 2P', monospace;
                    font-size: 0.6rem;
                    z-index: 1000;
                    box-shadow: 0 2px 10px rgba(0,255,255,0.5);
                `;
                banner.innerHTML = 'üåê VERCEL: Solo Campaign | Per multiplayer usa Replit/Heroku';
                document.body.appendChild(banner);
                
                // Aggiusta il padding del body
                document.body.style.paddingTop = '40px';
                
                // Modifica la card multiplayer
                const multiplayerCard = document.querySelector('.mode-card[onclick*="multiplayer"]');
                if (multiplayerCard) {
                    multiplayerCard.innerHTML = `
                        <h2>üåê MULTIPLAYER</h2>
                        <p>Non disponibile su Vercel</p>
                        <p class="mode-detail">‚Ä¢ Usa Replit o Heroku per multiplayer</p>
                        <p class="mode-detail">‚Ä¢ Campaign mode funziona perfettamente</p>
                        <button class="btn-secondary" disabled>NON DISPONIBILE</button>
                    `;
                }
            });
        }
    </script>
</body>
</html>
